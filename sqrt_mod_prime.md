# 费马小定理 & 欧拉定理

## 费马小定理

$n$ 为质数, 正整数 $a$ 不是 $p$ 的倍数时, $n, a$ 满足如下关系.
$$a^{n-1}\equiv_n 1$$

常用变式:
(1) 侧重强调模幂循环性:

$$
a^n \equiv_n a
$$

(2) 侧重强调模开方存在性:

$$
\left(a^\frac{n-1}{2}-1\right)\left(a^\frac{n-1}{1}+1\right)
\equiv_n
0
$$

## 欧拉定理

两正整数 $n$ 与 $a$ 互质时, $n, a$ 满足如下关系.

$$
a^{\varphi(n)} \equiv_n 1
$$

其中, $\varphi(n)$ 是 $n$ 以下的 & 与 $n$ 互质的正整数个数. 该函数称为 "Euler's totient function", 俗称 "Euler phi function". 汉译 "欧拉函数".

显然, 欧拉定理是费马小定理的泛化.

> 💡 为什么模幂运算强调==底数和模互质==? 当底数和模存在非平凡公因数 (也就是说, 公因数不是1) 时, 底数的有限次模幂将得到 0. 其后的更高次幂都将得到 0.

# 模 n 乘法子群

模 $n$ 加法子群的元素 (即整数 $0, 1, 2,$ $\cdots,$ $n-1$) 里, 与 $n$ 互质的元素构成模 $n$ 乘法子群.

## 证明

当 $\mathrm{gcd}(a, n) = 1$ 且 $\mathrm{gcd}(b,n)=1$ 时, $\mathrm{gcd}(ab, n)=1$. 又当 $a_1\equiv_n a_2$ 时, $\mathrm{gcd}\left(a_1,n\right)=\mathrm{gcd}\left(a_2,n\right)$. 因此, 与 $n$ 互质的元素关于在模 $n$ 乘法下是封闭的.

同余乘法满足交换律 & 结合律, 并且具有幺元 "整数 1".

最后, $a$ 存在模 $n$ 逆元, 当且仅当 $a, n$ 互质. (💡https://math.stackexchange.com/a/2101197 )

## 记号

以商群 (quotient group) 的形式表示模 n 乘法子群: $(\mathbb{Z}/n\mathbb{Z})^\times$ . 意义尚待考证.

# 模 n 原根

## 定义 & 存在性

当且仅当 $n$ 为 $2, 4,$ $p^k$, $2p^k$ ($p$ 为奇质数, $k$ 为正整数) 时, 模 $n$ 乘法子群是循环群. 把这样的循环群的生成元称为模 $n$ 原根.

> 高斯在 _Disquisitiones Arithmeticae_ 里对上述命题给出了两种证明.

模 $n$ 原根恰有 $\varphi\left(\varphi(n)\right)$ 个. 证明思路: 模 $n$ 乘法子群有 $r=\varphi(n)$ 个元素, 循环群有 $\varphi(r)$ 个生成元.

## 例子 (n=14)

模 14 乘法子群为{1, 3, 5, 9, 11, 13}

| $x$ | $x^1$ | $x^2$ | $x^3$ | $x^4$ | $x^5$ | $x^6$ | order | primitive? |
| --: | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ---------- |
|   1 | 1     |       |       |       |       |       | 1     |            |
|   3 | 3     | 9     | 13    | 11    | 5     | 1     | 6     | true       |
|   5 | 5     | 11    | 13    | 9     | 3     | 1     | 6     | true       |
|   9 | 9     | 11    | 1     |       |       |       | 3     |            |
|  11 | 11    | 9     | 1     |       |       |       | 3     |            |
|  13 | 13    | 1     |       |       |       |       | 2     |            |

## 性质

除了 3 以外, 任意质数 p 的原根的积与 1 模 p 同余. (高斯)

任意质数的 p 的原根的和与 $\mu(p-1)$ 模 p 同余, 其中 $\mu(\cdot)$ 为莫比乌斯函数. (高斯)

如果 a 是质数 p 的原根, 则 $a^{(p-1)/2}\equiv_n -1$ .

> 证明思路: 费马小定理, 侧重平方根存在性的变式. 要么等于 1, 要么等于-1. 假设等于 1, 则循环群变小. 所以只能是-1.

## 寻找原根

问题: 计算所有原根.
方案: 除暴力枚举外, 没有通用算法.

问题: 找到一个原根.
方案: 计算 $r=\varphi(n)$, 计算 $r$ 的质因数 $p_1, \cdots, p_k$ (注意不是 $n$ 的质因数). 之后, 搜索 $g_?$ , 使得对任意 $p_i$ , 下式都成立.

$$
g^{\varphi(n)/p_i} \not\equiv_n 1
$$

这样的 $g_?$ 就是一个生成元.

搜索空间仍然很大, 怎么收缩?

- n 为质数时, 虽然搜索空间是 ${2, \cdots, n-1}$, 但是命中概率很大.
  $$
  \mathrm{Prob}=\frac{1}{\varphi(n-1)}
  \in
  \mathrm{O}\left(\frac{1}{\log\log n}\right)
  $$
- n 为 $p^k, 2p^k$ 的情况, 详见[维基](https://en.wikipedia.org/wiki/Primitive_root_modulo_n#Finding_primitive_roots).

# 模为质数 p

## (1) 平方根存在性

### Euler's Criterion

方程 $x^2 \equiv_p a$ 要么有两个不相等的解, 要么没有解.

当

$$
a^{(p-1)/2} \equiv_p 1
$$

时, 有两个不相等的解.

当

$$
a^{(p-1)/2} \equiv_p -1
$$

时, 没有解.

### 证明

设 $r$ 为 $p$ 的原根. 因为 $p$ 为质数, 所以一定存在一个正整数 $k$ , 使得 $a=r^k$ . 进而

$$
a^{(p-1)/2}
= \left(r^{(p-1)/2}\right)^k
\equiv_p (-1)^k
$$

根据费马小定理, $a^{(p-1)/2}$ 只可能是 1 或-1. 分别对应偶数和奇数的 $k$ .

(case $k$ even) 设 $k=2j$ , 其中 $1\le j \le (p-1)/2$ . 则

$$
a^{(p-1)/2}
=r^{j(p-1)}
\equiv_p 1
$$

此时的两根为 $r^j, -r^j$ . 注意, 负根除了与 $p-r^j$ , 还与 $r^{j + (p-1)/2}$ 模 $p$ 同余; 证明利用了原根的性质, 如下式所示.

$$
-r^j
\equiv (-1)\cdot(r^j)
\equiv r^j \cdot r^{(p-1)/2}
\equiv r^{j + (p-1)/2}
~~(\mathrm{mod}~p)
$$

此时的两根一定满足 $r^j \not\equiv_p -r^j$ . 否则, 有 $2 r^j \equiv_p 0$ , 与原根非零矛盾.

这样的 $a$ 有 $(p-1)/2$ 个, 对应 $p-1$ 个平方根. 易证:
(1) 这些平方根是不同的. 因为这些平方根穷竭了原根的所有幂, 从而取遍 ${1, \cdots, n-1}$ .
(2) 根据(1), $a$ 穷竭了所有的模 $p$ 二次余项 (quadratic residue).

> 我们肯定不用 $r^j$ 来计算平方根. 因为没办法求 $j$ 呀. 这是个离散对数问题.

(case $k$ odd) 设 $k=2j + 1$ . 由于 $k$ 为偶数的情况已经穷竭了所有的模 $p$ 二次余项, $k$ 为奇数的情况已经解不出平方根. $\blacksquare$

## (2) 计算平方根

Tonelli-Shanks 算法
